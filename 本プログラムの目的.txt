本プログラムの目的

NIKKEにおける180秒間（毎秒60フレーム）間の攻撃・スキル発動・バフ適用・敵、味方ステータス情報全てをトレースすることで
ダメージのシミュレートを行うプログラム。

キャラクターごとに特殊な仕様が多いため、シミュレート中のキャラクターとは関係ないプログラムも多いが、
シミュレーターであるためどれだけ元ゲームのダメージ計算に近似できるかが重要。
そのため勝手な仕様の変更・削除を硬く禁ずる。

【基本】
NIKKEは180秒間の射撃・時間経過・バースト発動・編成・スキル適用時などを条件に各種スキルが発動する。

・射撃
射撃はMG,SMG,AR,SG,SR,RLの6種類の武器からなる。基本的な性能は武器種で決まっているが、
武器ダメージ・リロード速度・チャージ時間・チャージダメージはキャラによって異なることが多い。

また、武器によっては発射前後の隙、ファイアレート、ペレット数なども変わる特殊な武器の可能性もある。

基本的に以下のサイクルを180秒間ループする
[武器攻撃サイクル]
・連射武器
射撃準備（12F）→ 射撃（ファイアレート(F)×装弾数）→ 射撃後隙(10F) → リロード→射撃準備（12F）…
→特にMGは特殊で
「射撃準備時間を含め」35発（155F）まではファイアレートが抑制され、155F経過後は1発あたりファイアレートが1Fで射撃できるようになる。
ウォームアップ中の1発あたりに必要な射撃フレームは武器jsonファイルのwarmup_tableに格納している。

・チャージ武器
射撃準備（12F）→ チャージ → 射撃後隙(10F) →射撃準備（12F）→ チャージ → 射撃後隙(10F)→射撃準備（12F）→を装弾数分繰り返し、
(射撃終了)→射撃後隙(10F)→リロード→射撃準備（12F）

というサイクルとなっている。

（攻撃速度系バフの影響）
・攻撃速度バフ
ファイアレートを短縮するスキル。
[元の攻撃速度]/(1+攻撃速度バフ)
として計算され、100%のバフが来たときは攻撃速度は半分になる。

・チャージ速度バフ、リロード速度バフ こちらは「攻撃速度バフとは違う」計算式で適用され、**割合短縮と固定値短縮（フレーム数削除）**の双方が適用される。

計算式: MAX(1, INT([元の速度] * (1 - 速度バフ割合) - 速度バフ固定値))

※固定値バフ（reload_speed_fixed, charge_speed_fixed）はこの計算式でのみ使用され、攻撃速度（連射速度）には適用されない。 ※0フレーム以下にはならず、計算結果が1未満の場合は1Fとなる。

[1回あたりのダメージ]

ダメージ計算式は以下のようになっている。

(基礎攻撃力×(1+攻撃力割合バフ)+攻撃力固定バフ - 敵防御力 ×(1-防御力デバフ))

×武器ダメージ ×(1+武器ダメージ倍率バフ)

×(1+ フルバーストボーナス(50%) +  クリティカルダメージ(50%+クリティカルダメージバフ) + コアダメージ(100%+コアダメージバフ) + 距離適性ボーナス(30%))

×((チャージダメージ×チャージダメージ割合バフ)+チャージダメージバフ)

×(1+攻撃ダメージバフ+パーツダメージバフ+貫通ダメージバフ+防御無視ダメージバフ+持続ダメージバフ+粘着ダメージバフ+爆発ダメージバフ+バーストスキルダメージバフ)

×(1+受けるダメージデバフ)
※敵に付与できる「デバフ」であるが、味方にとってはバフなのでプログラム上はバフとして扱う。
例:敵に受けるダメージ40%▲ は(1+0.4)として計算される。

×(1+分配ダメージバフ)

×(1+有利コードダメージバフ)

という風にブロックに分けられて計算されている。

ダメージにはそれぞれフラグが割り当てられていて、どのバフが乗るかはそれで管理する。
基本的に通常攻撃にのり、スキルダメージに乗らないのが
コアダメージ、距離適性、チャージダメージ（パーツダメージ、貫通ダメージ、爆発ダメージ）

属性有利関係は以下のようになっている
"電撃"は"水冷"に有利
"水冷"は"灼熱"に有利
"灼熱"は"風圧"に有利
"風圧"は"鉄甲"に有利
"鉄甲"は"電撃"に有利

有利コードに対するバフは10%のダメージボーナスがかかる

バフはself(自己バフ)とalias(味方全体へのバフ)で分かれ、
発動条件なども管理されている。


武器性能の定義ファイルはwepons内のjson、キャラクターのスキル等の定義ファイルはcharacters内のjsonで行い、
ログは各キャラクターごとに作成される想定。
ログには各種攻撃ダメージと（通常攻撃であればペレット数）その時かかっているバフ等が記録される。


【バフの特殊仕様】

・発動者ステータス参照バフ (scale_by_caster_stats) 通常、atk_buff_fixed などの固定値バフは value の値をそのまま加算するが、スキル定義に "scale_by_caster_stats": true が指定されている場合、挙動が異なる。 この場合、value は「係数」として扱われ、 [適用される固定値] = [発動者の現在のステータス(ATK等)] * [value] として計算される。 これにより、「発動者の攻撃力のn%を攻撃力として加算する」といったスキルを再現する。


